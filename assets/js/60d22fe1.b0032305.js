"use strict";(self.webpackChunkrke_2_docs=self.webpackChunkrke_2_docs||[]).push([[691],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),c=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=a,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||r;return n?i.createElement(m,o(o({ref:t},u),{},{components:n})):i.createElement(m,o({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4194:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var i=n(7462),a=n(3366),r=(n(7294),n(3905)),o=["components"],s={sidebar_label:"Known Issues and Limitations",sidebar_position:12,title:""},l=void 0,c={unversionedId:"known_issues",id:"known_issues",title:"",description:"This section contains current known issues and limitations with rke2. If you come across issues with rke2 not documented here, please open a new issue here.",source:"@site/docs/known_issues.md",sourceDirName:".",slug:"/known_issues",permalink:"/rke2-docs/known_issues",draft:!1,editUrl:"https://github.com/kubewarden/docs/edit/main/docs/known_issues.md",tags:[],version:"current",lastUpdatedAt:1664191865,formattedLastUpdatedAt:"9/26/2022",sidebarPosition:12,frontMatter:{sidebar_label:"Known Issues and Limitations",sidebar_position:12,title:""},sidebar:"mySidebar",previous:{title:"Advanced Options and Configuration",permalink:"/rke2-docs/advanced"},next:{title:"Subcommands",permalink:"/rke2-docs/subcommands"}},u={},p=[{value:"Firewalld conflicts with default networking",id:"firewalld-conflicts-with-default-networking",level:2},{value:"NetworkManager",id:"networkmanager",level:2},{value:"Istio in Selinux Enforcing System Fails by Default",id:"istio-in-selinux-enforcing-system-fails-by-default",level:2},{value:"Control Groups V2",id:"control-groups-v2",level:2},{value:"Calico with vxlan encapsulation",id:"calico-with-vxlan-encapsulation",level:2},{value:"Wicked",id:"wicked",level:2}],d={toc:p};function h(e){var t=e.components,n=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This section contains current known issues and limitations with rke2. If you come across issues with rke2 not documented here, please open a new issue ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher/rke2/issues"},"here"),"."),(0,r.kt)("h2",{id:"firewalld-conflicts-with-default-networking"},"Firewalld conflicts with default networking"),(0,r.kt)("p",null,"Firewalld conflicts with RKE2's default Canal (Calico + Flannel) networking stack. To avoid unexpected behavior, firewalld should be disabled on systems running RKE2."),(0,r.kt)("h2",{id:"networkmanager"},"NetworkManager"),(0,r.kt)("p",null,"NetworkManager manipulates the routing table for interfaces in the default network namespace where many CNIs, including RKE2's default, create veth pairs for connections to containers. This can interfere with the CNI\u2019s ability to route correctly. As such, if installing RKE2 on a NetworkManager enabled system, it is highly recommended to configure NetworkManager to ignore calico/flannel related network interfaces. In order to do this, create a configuration file called ",(0,r.kt)("inlineCode",{parentName:"p"},"rke2-canal.conf")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/NetworkManager/conf.d")," with the contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[keyfile]\nunmanaged-devices=interface-name:cali*;interface-name:flannel*\n")),(0,r.kt)("p",null,"If you have not yet installed RKE2, a simple ",(0,r.kt)("inlineCode",{parentName:"p"},"systemctl reload NetworkManager")," will suffice to install the configuration. If performing this configuration change on a system that already has RKE2 installed, a reboot of the node is necessary to effectively apply the changes."),(0,r.kt)("p",null,"In some operating systems like RHEL 8.4, NetworkManager includes two extra services called ",(0,r.kt)("inlineCode",{parentName:"p"},"nm-cloud-setup.service")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"nm-cloud-setup.timer"),". These services add a routing table that interfere with the CNI plugin's configuration. Unfortunately, there is no config that can avoid that as explained in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher/rke2/issues/1053"},"issue"),". Therefore, if those services exist, they should be disabled and the node must be rebooted."),(0,r.kt)("h2",{id:"istio-in-selinux-enforcing-system-fails-by-default"},"Istio in Selinux Enforcing System Fails by Default"),(0,r.kt)("p",null,"This is due to just-in-time kernel module loading of rke2, which is disallowed under Selinux unless the container is privileged.\nTo allow Istio to run under these conditions, it requires two steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://istio.io/latest/docs/setup/additional-setup/cni/"},"Enable CNI")," as part of the Istio install. Please note that this ",(0,r.kt)("a",{parentName:"li",href:"https://istio.io/latest/about/feature-stages/"},"feature")," is still in Alpha state at the time of this writing.\nEnsure ",(0,r.kt)("inlineCode",{parentName:"li"},"values.cni.cniBinDir=/opt/cni/bin")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"values.cni.cniConfDir=/etc/cni/net.d")),(0,r.kt)("li",{parentName:"ol"},"After the install is complete, there should be ",(0,r.kt)("inlineCode",{parentName:"li"},"cni-node")," pods in a CrashLoopBackoff. Manually edit their daemonset to include ",(0,r.kt)("inlineCode",{parentName:"li"},"securityContext.privileged: true")," on the ",(0,r.kt)("inlineCode",{parentName:"li"},"install-cni")," container.")),(0,r.kt)("p",null,"This can be performed via a custom overlay as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nspec:\n  components:\n    cni:\n      enabled: true\n      k8s:\n        overlays:\n        - apiVersion: "apps/v1"\n          kind: "DaemonSet"\n          name: "istio-cni-node"\n          patches:\n          - path: spec.template.spec.containers.[name:install-cni].securityContext.privileged\n            value: true\n  values:\n    cni:\n      image: rancher/mirrored-istio-install-cni:1.9.3\n      excludeNamespaces:\n      - istio-system\n      - kube-system\n      logLevel: info\n      cniBinDir: /opt/cni/bin\n      cniConfDir: /etc/cni/net.d\n')),(0,r.kt)("p",null,"For more information regarding exact failures with detailed logs when not following these steps, please see ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher/rke2/issues/504"},"Issue 504"),"."),(0,r.kt)("h2",{id:"control-groups-v2"},"Control Groups V2"),(0,r.kt)("p",null,"RKE2 v1.19.5+ ships with ",(0,r.kt)("inlineCode",{parentName:"p"},"containerd")," v1.4.x or later, hence should run on cgroups v2 capable systems.",(0,r.kt)("br",{parentName:"p"}),"\n","Older versions (< 1.19.5) is shipped with containerd 1.3.x fork (with back-ported SELinux commits from 1.4.x)\nwhich does not support cgroups v2 and requires a little up-front configuration:"),(0,r.kt)("p",null,"Assuming a ",(0,r.kt)("inlineCode",{parentName:"p"},"systemd"),"-based system, setting the ",(0,r.kt)("a",{parentName:"p",href:"https://www.freedesktop.org/software/systemd/man/systemd.html#systemd.unified_cgroup_hierarchy"},"systemd.unified_cgroup_hierarchy=0"),"\nkernel parameter will indicate to systemd that it should run with hybrid (cgroups v1 + v2) support.\nCombined with the above, setting the ",(0,r.kt)("a",{parentName:"p",href:"https://www.freedesktop.org/software/systemd/man/systemd.html#systemd.legacy_systemd_cgroup_controller"},"systemd.legacy_systemd_cgroup_controller"),"\nkernel parameter will indicate to systemd that it should run with legacy (cgroups v1) support.\nAs these are kernel command-line arguments they must be set in the system bootloader so that they will be\npassed to ",(0,r.kt)("inlineCode",{parentName:"p"},"systemd")," as PID 1 at ",(0,r.kt)("inlineCode",{parentName:"p"},"/sbin/init"),"."),(0,r.kt)("p",null,"See:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.gnu.org/software/grub/manual/grub/grub.html#linux"},"grub2 manual")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.freedesktop.org/software/systemd/man/systemd.html#Kernel%20Command%20Line"},"systemd manual")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html"},"cgroups v2"))),(0,r.kt)("h2",{id:"calico-with-vxlan-encapsulation"},"Calico with vxlan encapsulation"),(0,r.kt)("p",null,"Calico hits a kernel bug when using vxlan encapsulation and the checksum offloading of the vxlan interface is on.\nThe issue is described in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/projectcalico/calico/issues/4865"},"calico project")," and in\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher/rke2/issues/1541"},"rke2 project"),". The workaround we are applying is disabling the checksum\noffloading by default by applying the value ",(0,r.kt)("inlineCode",{parentName:"p"},"ChecksumOffloadBroken=true")," in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rancher/rke2-charts/blob/main/charts/rke2-calico/rke2-calico/v3.19.2-203/values.yaml#L51-L53"},"calico helm chart"),"."),(0,r.kt)("p",null,"This issue has been observed in Ubuntu 18.04, Ubuntu 20.04 and openSUSE Leap 15.3"),(0,r.kt)("h2",{id:"wicked"},"Wicked"),(0,r.kt)("p",null,"Wicked configures the networking settings of the host based on the sysctl configuration files (e.g. under /etc/sysctl.d/ directory). Even though rke2 is setting parameters such as ",(0,r.kt)("inlineCode",{parentName:"p"},"/net/ipv4/conf/all/forwarding")," to 1, that configuration could be reverted by Wicked whenever it reapplies the network configuration (there are several events that result in reapplying the network configuration as well as rcwicked restart during updates). Consequently, it is very important to enable ipv4 (and ipv6 in case of dual-stack) forwarding in sysctl configuration files. For example, it is recommended to create a file with the name ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.d/90-rke2.conf")," containing these paratemers (ipv6 only needed in case of dual-stack):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"net.ipv4.conf.all.forwarding=1\nnet.ipv6.conf.all.forwarding=1\n")))}h.isMDXComponent=!0}}]);